rules:
  - id: flask-path-traversal-send-from-directory
    patterns:
      - pattern: send_from_directory($DIR, $FILENAME, ...)
      - pattern-not: send_from_directory($DIR, secure_filename($FILENAME), ...)
      - pattern-not: send_from_directory($DIR, os.path.basename($FILENAME), ...)
    message: |
      Potential path traversal vulnerability detected. The filename parameter is not sanitized
      before being passed to send_from_directory(). This could allow an attacker to access
      files outside the intended directory using '../' sequences.
    languages: [python]
    severity: ERROR
    metadata:
      category: security
      cwe:
        - "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')"
      owasp:
        - "A01:2021 - Broken Access Control"
      references:
        - https://owasp.org/www-community/attacks/Path_Traversal
        - https://flask.palletsprojects.com/en/2.0.x/api/#flask.send_from_directory
      technology:
        - flask
      confidence: HIGH
      likelihood: HIGH
      impact: HIGH
      subcategory:
        - vuln